{{ define "main" }}

<!-- âœ… External CSS (Hugo asset pipeline) -->
{{ $singleCSS := resources.Get "css/single.css" | minify | fingerprint }}
<link rel="stylesheet" href="{{ $singleCSS.RelPermalink }}">

<!-- ğŸŒ— Theme Toggle Button 
<button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ Toggle</button>
<script>
  const root = document.documentElement;
  const currentTheme = localStorage.getItem("theme") || "dark";
  root.setAttribute("data-theme", currentTheme);
  function toggleTheme() {
    const newTheme = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
    root.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);
  }
</script>
-->

<main class="section-inner single-post">

  <!-- âœ… Top Navbar -->
  <nav class="top-nav">
    <a href="/">ğŸ¡ Home</a>
    <a href="/posts/">ğŸ“˜ Blog</a>
    <a href="/notes/">ğŸ“ƒ Cheat-sheet</a>
    <a href="/projects/">ğŸ› ï¸ Projects</a>
    <a href="/about/">ğŸ—¿ About</a>
  </nav>

  <article class="content-article">

    <!-- âœ… Share Buttons (Now at the Top) -->
    <div class="share-buttons">
      <p>ğŸ”— Share this post:</p>
      <a href="https://twitter.com/intent/tweet?url={{ .Permalink }}&text={{ .Title }}" target="_blank">ğŸ¦ Twitter</a>
      <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ .Permalink }}" target="_blank">ğŸ”— LinkedIn</a>
      <button onclick="copyLink()">ğŸ“‹ Copy Link</button>
    </div>

    <script>
      function copyLink() {
        navigator.clipboard.writeText(window.location.href);
        alert("Link copied to clipboard!");
      }
    </script>

    <!-- âœ… Post Header -->
    <header class="post-header">
      <h1 class="post-title">{{ .Title }}</h1>
      <p>
        {{ with .Date }}
          <span class="post-date">ğŸ“… {{ .Format "Jan 2, 2006" }}</span>
        {{ end }}
        <span class="reading-time">â±ï¸ {{ .ReadingTime }} min read</span>
        <span class="view-count">ğŸ‘ï¸ Views: <span id="page-views">...</span></span>
      </p>

      <!-- âœ… Author -->
      <div class="author-box">
        <img src="/images/profile.jpg" alt="Author profile photo">
        <div>
          <strong>Koustubha Naik</strong><br>
          Cybersecurity Enthusiast â€¢ Homelabber â€¢ Blogger
        </div>
      </div>
    </header>

    <!-- âœ… Optional Featured Image -->
    {{ with .Params.featuredImg }}
      <div class="featured-image">
        <img src="{{ . | absURL }}" alt="Featured image for {{ $.Title }}">
      </div>
    {{ end }}

    <!-- âœ… Main Post Body -->
    <div class="post-body">
      {{ .Content | safeHTML }}
    </div>

    <!-- âœ… Tags -->
    {{ with .Params.tags }}
      <div class="post-tags">
        ğŸ·ï¸ Tags:
        {{ range . }}
          <a href="{{ "/tags/" | relURL }}{{ . | urlize }}">#{{ . }}</a>
        {{ end }}
      </div>
    {{ end }}

    <!-- âœ… Prev/Next -->
    <nav class="post-nav">
      {{ with .PrevInSection }}
        <a href="{{ .RelPermalink }}">â† {{ .Title }}</a>
      {{ end }}
      {{ with .NextInSection }}
        <a href="{{ .RelPermalink }}">{{ .Title }} â†’</a>
      {{ end }}
    </nav>

    <!-- âœ… View Counter -->
    <script>
      fetch(`https://counterapi.dev/api/koustubha.com{{ .RelPermalink }}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById("page-views").textContent = data.count;
        });
    </script>

    <!-- âœ… Comments -->
    {{ if .Params.comments }}
      <div id="comments">
        {{ partial "comments.html" . }}
      </div>
    {{ end }}

  </article>
</main>

{{ end }}
